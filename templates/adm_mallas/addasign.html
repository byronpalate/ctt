{% extends "formbs.html" %}
{% block extrajavascript %}
    <script type="text/javascript">
        $(function () {
            // Add classes
            $("#id_campoformacion, #id_areaconocimiento, #id_tipomateria, #id_ejeformativo, #id_nivelmalla, #id_asignatura, #id_horas, #id_creditos, #id_identificacion").addClass("validate[required]");
            $("#fieldset_itinerario").hide()

            cargaritinerarios = function () {
                if ($('#id_tieneitinerario').is(':checked')) {
                    $("#fieldset_itinerario").show()
                    var elemento = $(this);
                    $('#id_itinerario').empty().append('<option value="">---------</option>').val(0);
                    var id = {{ malla.id }};
                    if (id > 0) {
                        bloqueointerface();
                        $.ajax({
                            type: "POST",
                            url: "/adm_mallas",
                            data: {'action': 'cargaritinerarios', 'malla_id': id, 'csrfmiddlewaretoken': csrftoken},
                            success: function (data) {
                                desbloqueointerface();
                                if (data.result === 'ok') {
                                    for (item in data.lista) {
                                        $('#id_itinerario').append('<option value="' + data.lista[item][0] + '">' + data.lista[item][1] + '</option>').val(0);
                                    }
                                } else {
                                    elemento.val(0);
                                    NotificacionAlerta(data.icono, data.titulo, data.mensaje);
                                }
                            },
                            error: function () {
                                desbloqueointerface();
                                elemento.val(0);
                                NotificacionError('!!!', 'Error de conexi√≥n');
                            },
                            dataType: "json"
                        });
                    }

                } else {
                    $("#fieldset_itinerario").hide()
                }
            };

            cargaritinerarios();

            $("#id_tieneitinerario").change(function () {
                cargaritinerarios();
            });

            const practicas = function () {
                const codigopracticas = $("#id_codigopracticas");
                const fieldsetCodigopracticas = $("#fieldset_codigopracticas");

                if ($("#id_practicas").is(':checked')) {
                    codigopracticas.addClass("validate[required]");
                    fieldsetCodigopracticas.show();
                } else {
                    codigopracticas.val('').removeClass("validate[required]");
                    fieldsetCodigopracticas.hide();
                }
            };

            $("#id_practicas").click(practicas);

            const fieldsToBlur = $("#id_horassemanales, #id_horas, #id_organizacionaprendizaje, #id_horasasistidas, #id_horasdocencia, #id_horascolaborativas, #id_horasorganizacionaprendizaje, #id_horasautonomas, #id_horascolaborativas, #id_horaspracticas");
            fieldsToBlur.blur(function () {
                numerico($(this), 0, 0, 2);
            });

            $("#id_creditos").blur(function () {
                numerico($(this), 0, 20, 4);
            });

            $("#id_cantidadmatriculas").blur(function () {
                numerico($(this), 1, 0, 0);
            });




            practicas();



        });
    </script>
{% endblock %}
{% block atras %}/adm_mallas?action=edit&id={{ malla.id }}{% endblock %}
{% block formdestination %}/adm_mallas?action=edit&id={{ malla.id }}{% endblock %}
{% block titulo %}{{ title }}{% endblock %}
{% block formaction %}/adm_mallas{% endblock %}
{% block formextra %}
    <input type='hidden' name='action' value='addasign'/>
    {% if eje %}
        <input type='hidden' name='eje' value='{{ eje.id }}'/>
        <input type='hidden' name='nivel' value='{{ nivel.id }}'/>
    {% endif %}
    <input type='hidden' name='malla' value='{{ malla.id }}'/>
{% endblock %}
{% block formback %}/adm_mallas?action=edit&id={{ malla.id }}{% endblock %}
